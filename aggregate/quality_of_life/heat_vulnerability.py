import pandas as pd
from ingest.ingestion_helpers import add_leading_zero_PUMA
from internal_review.set_internal_review_file import set_internal_review_files


def load_clean_heat_vulnerability(geography):
    assert geography == "puma", "This indicator only calculated at PUMA level"
    df = pd.read_excel(
        "./resources/quality_of_life/HVI_PUMA_Subboro_forSharing.xlsx",
        usecols=["PUMACE10", "HVI"],
        dtype={"PUMACE10": str, "HVI": int},
    )

    df.rename(
        columns={"PUMACE10": "puma", "HVI": "health_heat"},
        inplace=True,
    )

    print(f"Successfully loaded heat vulnerability xlsx")

    df = add_leading_zero_PUMA(df)

    print(f"Add leading zero to puma column")

    return df


def set_results_for_internal_review(df, geography):
    """Saves results to .csv so that reviewers can see results during code review"""
    set_internal_review_files(
        data=[
            (df, "heat_vulnerability_puma.csv", geography),
        ],
        category="quality_of_life",
    )
